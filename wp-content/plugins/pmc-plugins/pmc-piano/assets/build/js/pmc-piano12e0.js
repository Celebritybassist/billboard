var pmcPiano;(()=>{"use strict";var e={520:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.pianoConsent=void 0,o.pianoConsent={canDebug:window.pmcPianoData.canDebug,onetrustToPianoMapping:{C0001:{COMPOSER:1,DMP:1,ID:1,PA:1,VX:1},C0002:{COMPOSER:1,DMP:2,ID:1,PA:1,VX:3},C0003:{COMPOSER:3,DMP:2,ID:3,PA:3,VX:2},C0004:{COMPOSER:2,DMP:3,ID:2,PA:2,VX:2}},pianoProductModes:{COMPOSER:1,DMP:1,ID:1,PA:1,VX:1},pianoWeightsToModes:{1:"opt-out",2:"essential",3:"opt-in"},hookIntoOneTrust:function(){var e=this;e.canDebug&&console.log("PMC: Piano:","Consent Initialization.."),window.pmc.hooks.add_action("pmc_onetrust_consent_data_ready",e.determinePianoProductModes.bind(e))},determinePianoProductModes:function(e){var o=e.groupsConsentedTo,n=this;n.canDebug&&console.log("PMC: Piano:","pmc_onetrust_consent_data_ready","OneTrust groups consented to",o);var t={COMPOSER:[],DMP:[],ID:[],PA:[],VX:[]};0<o.length&&(o.forEach((function(e){Object.keys(t).forEach((function(o){n.onetrustToPianoMapping[e]&&t[o].push(n.onetrustToPianoMapping[e][o])}))})),n.canDebug&&console.log("PMC: Piano:","pianoProductsWeights",t),Object.keys(t).forEach((function(e){n.pianoProductModes[e]=Math.max.apply(Math,t[e])})),n.canDebug&&console.log("PMC: Piano:","pianoProductModes",n.pianoProductModes)),window.tp.push(["init",n.setPianoProductModes.bind(n)])},setPianoProductModes:function(){var e,o,n,t,i,s=this;window.pdl=window.pdl||{},window.pdl.requireConsent=!0,window.tp.consent.set("DL",{mode:"opt-out"}),window.tp.consent.set("ESP",{mode:"opt-out"}),window.tp.consent.set("Social Flow",{mode:"opt-out"}),window.tp.consent.set("COMPOSER",{mode:null!==(e=s.pianoWeightsToModes[s.pianoProductModes.COMPOSER])&&void 0!==e?e:"opt-out"}),window.tp.consent.set("DMP",{mode:null!==(o=s.pianoWeightsToModes[s.pianoProductModes.DMP])&&void 0!==o?o:"opt-out"}),window.tp.consent.set("ID",{mode:null!==(n=s.pianoWeightsToModes[s.pianoProductModes.ID])&&void 0!==n?n:"opt-out"}),window.tp.consent.set("PA",{mode:null!==(t=s.pianoWeightsToModes[s.pianoProductModes.PA])&&void 0!==t?t:"opt-out"}),window.tp.consent.set("VX",{mode:null!==(i=s.pianoWeightsToModes[s.pianoProductModes.VX])&&void 0!==i?i:"opt-out"}),s.canDebug&&console.log("PMC: Piano:","tp.consent.get()",window.tp.consent.get())}}},13:function(e,o,n){var t=this&&this.__awaiter||function(e,o,n,t){return new(n||(n=Promise))((function(i,s){function a(e){try{c(t.next(e))}catch(e){s(e)}}function r(e){try{c(t.throw(e))}catch(e){s(e)}}function c(e){var o;e.done?i(e.value):(o=e.value,o instanceof n?o:new n((function(e){e(o)}))).then(a,r)}c((t=t.apply(e,o||[])).next())}))},i=this&&this.__generator||function(e,o){var n,t,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function r(r){return function(c){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(a=0)),a;)try{if(n=1,t&&(i=2&r[0]?t.return:r[0]?t.throw||((i=t.return)&&i.call(t),0):t.next)&&!(i=i.call(t,r[1])).done)return i;switch(t=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,t=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=o.call(e,a)}catch(e){r=[6,e],t=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}};Object.defineProperty(o,"__esModule",{value:!0});var s=n(520),a={initialized:!1,scriptUrl:window.pmcPianoData.scriptUrl,isIPUser:!1,isProd:window.pmcPianoData.isProd,canDebug:window.pmcPianoData.canDebug,userCustomFieldsEndpoint:"/wp-json/pmc/piano/v1/user/custom-fields",user:null,onLoggedInUserCallbacks:[],onLoggedOutUserCallbacks:[],onPageLoadNotHasUserCallbacks:[],onHasIPUserCallbacks:[],myAccountPageSelector:".js-subscription-my-account-component",passwordResetPageSelector:".js-subscription-password-reset-component",pianoPaywallSelector:"#piano-paywall",pmcPaywallSelector:".pmc-paywall",truncatedContentSelector:"a-article-cropped",primeTp:function(){this.canDebug&&console.log("PMC: Piano:","Priming window.tp.."),s.pianoConsent.hookIntoOneTrust()},checkTp:function(){window.tp&&!Array.isArray(window.tp)&&window.tp.pianoId?this.tpLoaded():setTimeout(this.checkTp.bind(this),500)},tpLoaded:function(){window.tp&&window.tp.push(["init",this.initialize.bind(this)])},initialize:function(){var e=this,o=window.tp;e.isProd||(o.push(["setSandbox",!0]),o.push(["setPianoIdUrl","https://sandbox.tinypass.com"])),e.canDebug&&(console.log("PMC: Piano:","Initializing.."),o.push(["setDebug",!0])),o.push(["setUsePianoIdUserProvider",!0]),o.push(["addHandler","loginSuccess",function(o){e.canDebug&&console.log("PMC: Piano: loginSuccess",o),e.setUserData.apply(e)}]),o.push(["addHandler","checkoutComplete",function(){/reader_id=amp/gi.exec(window.location.search)&&window.close()}]),window.onmessage=e.registrationSuccess.bind(e),e.setUserData.apply(e),e.registerOnPageLoadNotHasUserCallback(e.maybeRenderMyAccountPage.bind(e)),e.registerOnLoggedInUserCallback(e.maybeRenderMyAccountPage.bind(e)),e.registerOnLoggedOutUserCallback(e.maybeRenderMyAccountPage.bind(e)),e.registerOnLoggedInUserCallback(e.reRenderExperiences.bind(e)),e.registerOnLoggedOutUserCallback(e.reRenderExperiences.bind(e)),e.maybeRenderPasswordResetPage.apply(e),e.registerOnLoggedInUserCallback(e.setAuthenticatedUserId.bind(e))},setAuthenticatedUserId:function(){var e=window.blogherads||{},o=this.getUser().uid;this.canDebug&&console.log("PMC: Piano: setAuthenticatedUserId",o),e.adq=e.adq||[],e.adq.push((function(){try{e.setAuthenticatedUserId(o,"piano")}catch(e){}}))},registrationSuccess:function(e){var o=this;if("string"==typeof e.data){var n=void 0;try{n=JSON.parse(e.data)}catch(e){return o.canDebug&&console.warn("PMC: Piano: registration",e),!1}n.sender&&n.sender.startsWith("piano-id")&&"registrationSuccess"===n.event&&(o.canDebug&&console.log("PMC: Piano: registrationSuccess",e),o.onLoggedInUserCallbacks=o.onLoggedInUserCallbacks.filter((function(e){return"bound reRenderExperiences"!==e.name})))}return!0},login:function(e){e.preventDefault(),window.tp.pianoId.show({screen:"login"})},logout:function(e){var o=window.pmcPiano.piano;e.preventDefault(),window.tp.pianoId.logout(o.onLogout)},onLogout:function(){var e=window.pmcPiano.piano;e.canDebug&&console.log("PMC: Piano: User logged-out",e.user),e.user=null,e.triggerOnLoggedOutUserCallbacks()},hasUser:function(){return!!this.user},hasIPUser:function(){return!!this.isIPUser},getUser:function(){return this.user},setUserData:function(){var e=this,o=window.tp;o.user.isUserValid()?o.pianoId.getUser()&&(e.initialized=!0,e.user=o.pianoId.getUser(),e.canDebug&&console.log("PMC: Piano: User logged-in",e.user),e.triggerOnLoggedInUserCallbacks()):(e.canDebug&&console.log("PMC: Piano: Page load, no user"),e.initialized=!0,e.user=null,e.triggerOnPageLoadNotHasUserCallbacks())},registerStickyFooter:function(e){var o=window.pmcPiano.piano;o.registerOnPageLoadNotHasUserCallback(function(){var n=document.querySelector(e.className||".js-subscription-sticky-footer");if(n){var t=document.getElementsByClassName(e.targetClassName||"footer"),i=function(){var e=function(){var e=window.scrollY,o=window.innerHeight,i=t[0].offsetTop;return e+o+("static"===n.style.position?n.clientHeight:0)>i};setTimeout(function(){this.stickyFooterPrevTime=this.stickyFooterPrevTime||Date.now(),this.stickyFooterPrevTime&&500>Date.now()-this.stickyFooterPrevTime||(this.stickyFooterPrevTime=Date.now(),e()||"fixed"===n.style.position?e()&&"static"!==n.style.position&&(n.style.position="static"):(n.style.position="fixed",n.style.bottom="0px"))}.bind(o),500)};i(),window.addEventListener("load",i),window.addEventListener("scroll",i),window.addEventListener("resize",i)}}.bind(o))},getUserCustomFields:function(){return t(this,void 0,void 0,(function(){return i(this,(function(e){return[2,window.pmcPiano.pianoApi.getFromEndpoint("".concat(this.userCustomFieldsEndpoint,"/").concat(this.user.uid))]}))}))},getAccountType:function(e){return["email_domain_contract","specific_email_addresses_contract"].includes(e)?"site_license":"individual"},registerOnLoggedInUserCallback:function(e){this.initialized&&this.hasUser()&&e(this.getUser()),this.onLoggedInUserCallbacks.push(e)},registerOnLoggedOutUserCallback:function(e){this.onLoggedOutUserCallbacks.push(e)},registerOnPageLoadNotHasUserCallback:function(e){this.initialized&&!this.hasUser()&&e(),this.onPageLoadNotHasUserCallbacks.push(e)},registerOnHasIPUserCallback:function(e){this.initialized&&!0===this.hasIPUser()&&e(),this.onHasIPUserCallbacks.push(e)},triggerOnLoggedInUserCallbacks:function(){var e=this;e.canDebug&&console.log("PMC: Piano: Running login callbacks",e.onLoggedInUserCallbacks),e.onLoggedInUserCallbacks.forEach((function(o){o(e.user)}))},triggerOnLoggedOutUserCallbacks:function(){var e=this;e.canDebug&&console.log("PMC: Piano: Running logout callbacks",e.onLoggedOutUserCallbacks),e.onLoggedOutUserCallbacks.forEach((function(e){e()}))},triggerOnPageLoadNotHasUserCallbacks:function(){var e=this;e.canDebug&&console.log("PMC: Piano: Running no-user callbacks",e.onPageLoadNotHasUserCallbacks),e.onPageLoadNotHasUserCallbacks.forEach((function(e){e()}))},triggerOnHasIPUserCallbacks:function(){var e=this;e.canDebug&&console.log("PMC: Piano: Running has-IP-user callbacks",e.onHasIPUserCallbacks),e.onHasIPUserCallbacks.forEach((function(e){e()}))},setIPUser:function(){var e=this;e.canDebug&&console.log("PMC: Piano: IP Match"),e.isIPUser=!0,e.triggerOnHasIPUserCallbacks()},maybeRenderMyAccountPage:function(){document.querySelector(this.myAccountPageSelector)&&window.tp.myaccount.show({displayMode:"inline",containerSelector:this.myAccountPageSelector})},maybeRenderPasswordResetPage:function(){if(!document.querySelector(this.passwordResetPageSelector))return"password reset element missing";var e=window.location.search.match(/reset_token=([A-Za-z0-9]+)/);return e?(window.onmessage=this.redirectHomeOnClosedMessage,window.tp.pianoId.show({resetPasswordToken:e[1],loggedIn:function(){window.location="/"}})):"invalid token"},redirectHomeOnClosedMessage:function(e){if("string"==typeof e.data){var o=JSON.parse(e.data);o.sender&&o.sender.startsWith("piano-id")&&"closed"===o.event&&(window.location="/")}},reRenderExperiences:function(){var e=this,o=window.tp;e.canDebug&&console.log("PMC: Piano: Re-rendering Experiences"),o.offer.closeInline(e.pianoPaywallSelector),o.offer.closeInline("#piano-right-rail"),o.offer.closeInline("#piano-mid-river"),o.offer.closeInline("#piano-sticky-footer"),o.offer.closeInline("#piano-fly-out");var n=document.querySelector(e.pmcPaywallSelector);n&&n.classList.remove(e.truncatedContentSelector),o.experience.execute()}};a.primeTp(),a.checkTp(),e.exports=a}},o={},n=function n(t){var i=o[t];if(void 0!==i)return i.exports;var s=o[t]={exports:{}};return e[t].call(s.exports,s,s.exports,n),s.exports}(13);(pmcPiano=void 0===pmcPiano?{}:pmcPiano).piano=n})();